version: '2'
services:
  che-server:
    image: eclipse/che-server:latest
    dns:
      - 1.1.1.1
      - 1.0.0.1
    environment:
      - CHE_HOST=${HOST_IP}
      - CHE_PORT=${CHE_PORT}
    labels:
      io.rancher.container.pull_image: always
      io.rancher.scheduler.affinity:host_label: ${LABEL_KEY_VALUE}
      io.rancher.container.hostname_override: eclipse-che
    ports:
      - "${CHE_PORT}:8080"
    privileged: true
    restart: on-failure
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ${STORAGE_BASE_DIR}${DATA_DIR}:/data
      - ${STORAGE_BASE_DIR}${REPO_DIR}:/repo